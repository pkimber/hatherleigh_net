{% extends "story/base.html" %}
{% load staticfiles %}

{% block stylesheets %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'base/css/dropzone/dropzone.css' %}">
{% endblock stylesheets %}

{% block sub_title %}
  {% if story %}
    Update
  {% else %}
    Create
  {% endif %}
  a news story
{% endblock sub_title %}

{% block sub_heading %}
  {% if story %}
    Update
  {% else %}
    Create
  {% endif %}
  a news story
{% endblock sub_heading %}

{% block content %}
  <div class="pure-g-r">
    <div class="pure-u-1">
      {% if story %}
        <p>
          Created by {{ story.author }}
          {% if story.email %}
            {{ story.email|urlize }}
          {% endif %}
          <small>
          on {{ story.created|date:"l d/m/y H:i" }}
          </small>
        </p>
      {% endif %}
      {% include '_form.html' with legend='News' multipart=True %}
    </div>
  </div>
{% endblock content %}

{% block script %}
  {{ block.super }}
  <script src="{% static 'base/js/ck/ckeditor.js' %}" type="text/javascript"></script>
  <script type="text/javascript">
    CKEDITOR.replace('id_description' );
  </script>
  <script src="{% static 'base/js/dropzone/dropzone.js' %}" type="text/javascript"></script>
  <script type="text/javascript">
    Dropzone.options.myForm = {
      // Prevents Dropzone from uploading dropped files immediately
      autoProcessQueue : false,
      maxFiles: 1,
      paramName: "picture",
      init : function() {
        var submitButton = document.querySelector("#my_submit")
        myForm = this;
        submitButton.addEventListener("click", function() {
          myForm.processQueue();
          // Tell Dropzone to process all queued files.
        });
        // You might want to show the submit button only when
        // files are dropped here:
        this.on("addedfile", function() {
            // Show submit button here and/or inform user to click it.
        });
      }
    };
  </script>
{% endblock script %}
